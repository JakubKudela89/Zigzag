function [val] = F4(x,k,m,lmbd)
% F4 benchmark function with values of M and s
% x can be an n times d matrix, with n points in dimension d
[n,d] = size(x); val = 0; 
if d == 2
    M = [0.969630678081746,0.032261150951298;0.032261150951298,0.965729170262545];
    s = [-26,79]; x = (x+s)*M;
elseif d == 5
   M = [0.768222239035048,-0.0144828851384242,0.0747558793268237,-0.00797364500162288,-0.0111034725391760;-0.0144828851384242,0.824570546786394,0.104306808481677,0.0238145077659992,0.0386909656339647;0.0747558793268231,0.104306808481677,0.864219991777684,-0.0240143974721478,0.0906628618265609;-0.00797364500162332,0.0238145077659995,-0.0240143974721478,0.802352156955154,-0.0565124949226014;-0.0111034725391759,0.0386909656339651,0.0906628618265615,-0.0565124949226015,0.741185544418181];
   s = [15,-27,-6,-6,7];   x = (x+s)*M;
elseif d == 10
   M = [0.762756877935184,-0.0130954833557423,-0.0669578415131016,-0.0619942873727506,0.0278683928652267,-0.0421621409522102,-0.0417211158121454,0.0400867971974489,0.00558262982735774,0.0335737462620366;-0.0130954833557410,0.755129143947865,0.0848536882460454,-0.0595886353072684,-0.0675723246835331,0.00190841126755221,0.0428857843236866,-0.0528708177322143,0.0198722011571557,-0.0136791084237019;-0.0669578415131006,0.0848536882460455,0.761383144996954,-0.0261601941328494,0.0416872255629752,-0.0352960097077065,-0.0398485606710888,-0.0345650339636446,0.0458472640552830,0.00725867509378452;-0.0619942873727494,-0.0595886353072694,-0.0261601941328503,0.668078446739459,-0.0176120726280882,-0.0272132973150756,-0.0134111902484941,0.00135252429028578,0.00397482949500701,-0.000422412783137544;0.0278683928652269,-0.0675723246835334,0.0416872255629749,-0.0176120726280881,0.723876500704039,0.0377168429324048,0.0556227428626881,0.0167233173357856,-0.0758440967220839,-0.00861439290170447;-0.0421621409522100,0.00190841126755214,-0.0352960097077065,-0.0272132973150753,0.0377168429324045,0.814669048642084,0.0149028399691696,0.0256755379059751,-0.0698345776904802,-0.0196736924728112;-0.0417211158121451,0.0428857843236865,-0.0398485606710885,-0.0134111902484936,0.0556227428626884,0.0149028399691697,0.812673638484402,0.0397055228336932,-0.117067185932522,-0.00796237422000477;0.0400867971974480,-0.0528708177322144,-0.0345650339636448,0.00135252429028518,0.0167233173357855,0.0256755379059748,0.0397055228336933,0.766211661494716,0.0600606996025869,-0.0263206226191104;0.00558262982735753,0.0198722011571561,0.0458472640552833,0.00397482949500734,-0.0758440967220838,-0.0698345776904804,-0.117067185932522,0.0600606996025867,0.725697599745590,0.0768593454170118;0.0335737462620368,-0.0136791084237019,0.00725867509378449,-0.000422412783137619,-0.00861439290170446,-0.0196736924728113,-0.00796237422000469,-0.0263206226191102,0.0768593454170119,0.788991826347627];
   s = [75,-77,63,-91,22,84,83,13,97,22];  x = (x+s)*M;
elseif d == 15
   M = [0.812661362033808,-0.0402338231717008,-0.0241296447210947,0.0315708802538068,-0.0316192890220595,-0.0717277087084575,0.0544058082528688,0.0334770182157444,-0.0284055361439753,-0.0260030832528241,0.0541932318304921,-0.0383213824997761,0.0595705894688564,0.0298874145285677,0.0121141795692146;-0.0402338231717006,0.729161868640356,-0.0181167663243464,-0.0129775778637795,0.0277278615148898,-0.0148325063398206,-0.0492091076498418,-0.00403707101956285,0.0424184725068623,0.0189740042118820,-0.0277452580954568,-0.0153065251174257,-0.0179186866211587,0.0496850333851164,-0.00524450468716761;-0.0241296447210956,-0.0181167663243468,0.798400147856486,-0.0714543873767647,-0.000746323585125955,-0.0164766388364478,-0.0236488947271922,-0.0181960723244513,-0.0230882421439513,-0.0874310193932258,0.00672742360524292,-0.0108779741576064,-0.0554461897689676,-0.0132923667542588,0.00873540121962092;0.0315708802538068,-0.0129775778637796,-0.0714543873767642,0.690130623961081,0.0139930314864894,-0.0451404641482881,-0.00511351329587732,-0.0106132373636073,-0.00141354750054517,0.0338143582415361,-0.0140836195708102,-0.0147329952748543,0.0357959968282132,0.0254976477943539,0.00378157293779363;-0.0316192890220591,0.0277278615148896,-0.000746323585125198,0.0139930314864894,0.656003905764717,0.0187205694017364,-0.0220531153274358,-0.00929181111840543,0.0316496546013656,0.0109904820789491,-0.0329267173263645,-0.00640476428521548,0.0347263544528439,0.000361782683511109,0.0456285674079351;-0.0717277087084583,-0.0148325063398209,-0.0164766388364488,-0.0451404641482878,0.0187205694017360,0.796087060800842,0.0733069629695093,0.00259434465421223,0.0401940806694628,-0.0476537136326969,-0.000355488211589932,0.000991952072136530,0.0575891291417725,0.00747718022913458,-0.0983415565148947;0.0544058082528688,-0.0492091076498417,-0.0236488947271934,-0.00511351329587698,-0.0220531153274360,0.0733069629695089,0.789902235133585,0.0321810469409292,0.0805064564043657,-0.00660479281956812,-0.0361051860017146,-0.0229945194578949,0.0141948887779761,0.0253760575221561,-0.0248479292172187;0.0334770182157446,-0.00403707101956296,-0.0181960723244507,-0.0106132373636073,-0.00929181111840583,0.00259434465421221,0.0321810469409290,0.785447768114317,-0.00745698584643119,0.00787561685126640,0.0486679563545710,-0.00361160640068835,0.00421523522118142,-0.0191074122932055,-0.0609837774689600;-0.0284055361439757,0.0424184725068624,-0.0230882421439526,-0.00141354750054466,0.0316496546013656,0.0401940806694618,0.0805064564043651,-0.00745698584643087,0.705647264730417,-0.0168512160155246,-0.0238686897090854,0.00196720348159663,0.0137800673554912,0.0318160451153979,-0.0571086404871167;-0.0260030832528234,0.0189740042118819,-0.0874310193932219,0.0338143582415355,0.0109904820789494,-0.0476537136326949,-0.00660479281956755,0.00787561685126608,-0.0168512160155257,0.784928605556504,-0.0178420920280646,0.0807629731917170,0.0183455152330836,0.0318737577464974,0.0145319220009503;0.0541932318304926,-0.0277452580954564,0.00672742360524314,-0.0140836195708099,-0.0329267173263643,-0.000355488211590221,-0.0361051860017154,0.0486679563545710,-0.0238686897090867,-0.0178420920280620,0.760146025078955,0.0817464449478896,0.0409441559165007,-0.00392193649607534,-0.0123459594960333;-0.0383213824997750,-0.0153065251174254,-0.0108779741576041,-0.0147329952748544,-0.00640476428521484,0.000991952072137367,-0.0229945194578957,-0.00361160640068854,0.00196720348159450,0.0807629731917205,0.0817464449478885,0.866867827160297,-0.0134244398214916,0.0273821627221272,-0.0566975239058750;0.0595705894688561,-0.0179186866211587,-0.0554461897689667,0.0357959968282130,0.0347263544528437,0.0575891291417734,0.0141948887779767,0.00421523522118144,0.0137800673554915,0.0183455152330826,0.0409441559164998,-0.0134244398214932,0.691693556853355,-0.00661949118689624,-0.0253500173720803;0.0298874145285683,0.0496850333851163,-0.0132923667542570,0.0254976477943532,0.000361782683510941,0.00747718022913516,0.0253760575221563,-0.0191074122932052,0.0318160451153977,0.0318737577464963,-0.00392193649607622,0.0273821627221255,-0.00661949118689631,0.666996981059938,-0.00704130426592768;0.0121141795692144,-0.00524450468716770,0.00873540121961997,0.00378157293779448,0.0456285674079352,-0.0983415565148956,-0.0248479292172193,-0.0609837774689599,-0.0571086404871171,0.0145319220009513,-0.0123459594960325,-0.0566975239058733,-0.0253500173720806,-0.00704130426592724,0.757231521828110];
   s= [33,73,-83,92,-27,-18,97,52,-79,29,50,67,-71,86,2]; x = (x+s)*M;
elseif d == 20
   M = [0.693511278253284,0.00613191036497968,-0.000114815920433391,0.0335765066730594,0.0740849591707561,-0.00471089503587587,0.0240261015638522,0.0217068339342143,0.0207896609433463,0.00508436638023548,0.0237489918633490,0.0229805598224606,-0.0256881818399144,-0.0181343192477101,-0.0305655493993890,-0.0115753537276009,-0.0176433485443867,0.00304972372985203,0.00191747464835645,-0.00975794992696314;0.00613191036498018,0.699546563865564,0.0195757015764036,-0.0331419876271863,0.0545425300258343,0.0457796677018669,0.0170043289533244,0.00320483613462107,0.00400176049795694,-0.0204350147636196,0.0326036734521649,0.0112604290245983,0.0331586867288142,-0.0231725467546912,0.00937551377822146,0.0244296449704621,0.00708819660465832,-0.0153031767115644,0.0156570068722795,-0.0226098767449024;-0.000114815920433144,0.0195757015764016,0.698156717970877,-0.0280206821218100,-0.0439014803518028,0.0365626578166913,-0.00509112138075083,-0.0546584199333683,-0.0344837531821123,0.0374653251663727,-0.0264750167707207,0.00692674742366428,0.0130271097958440,0.0479632523770256,0.0586037002111312,-0.0342445646940756,-0.0133067557026460,-0.0211881346865084,-0.0175962888840337,0.0211709306347586;0.0335765066730597,-0.0331419876271869,-0.0280206821218093,0.666856766977082,0.00118341154492602,-0.00459426914451942,0.0384706976758011,0.0161715085932248,0.0104721889799978,0.0133967106024553,-0.0117987612086818,0.0567671128294094,-0.0212458361999644,-0.0313781868274025,-0.0190482911045126,0.0185543968177525,0.0201793870142973,0.0396527240135007,-0.0261878753826533,-0.0339590319344986;0.0740849591707563,0.0545425300258319,-0.0439014803518014,0.00118341154492544,0.821355430129726,-0.0263018024924833,-0.00794268690636876,0.0270060725822778,0.0443180766647918,-0.0194989877057594,-0.00405208239440903,-0.0522322968159035,0.0220172586733876,-0.0850471706870603,-0.0334446383023925,-0.0627971336354350,-0.0473616225124345,-0.0612106258992945,0.0316533076712698,0.00595715825206282;-0.00471089503587486,0.0457796677018625,0.0365626578166914,-0.00459426914452025,-0.0263018024924847,0.744394141129688,0.0413048474688513,0.00631769402577268,-0.0522994137753620,-0.0290615207191102,0.0135915042541635,0.0736167902704767,0.0376629751366714,-0.0273395076943699,0.00585139759363272,0.00547756061636418,0.0393124336369920,-0.0459067421577432,-0.0566248412160475,-0.0719168363652886;0.0240261015638521,0.0170043289533245,-0.00509112138075108,0.0384706976758011,-0.00794268690636866,0.0413048474688503,0.703914476835295,0.0701504661977575,-0.0364609102513712,0.0206771746014383,0.0465629257476975,0.00757867168316406,0.0282870459266200,-0.0297404558552760,0.0248739038023483,0.0320447684194613,-0.00464030451874593,0.0711983673780026,-0.0125983901701055,-0.0450882800177315;0.0217068339342142,0.00320483613461928,-0.0546584199333679,0.0161715085932242,0.0270060725822772,0.00631769402577263,0.0701504661977575,0.785149589412305,-8.92873816409780e-05,-0.00796683593637756,-0.0719995309657638,0.00894766976668663,0.0616906683279437,-0.0371345351632839,0.0372283671052188,0.0220876934822290,0.00293394752607621,0.0588384971652737,0.0178173983232506,0.0205272541717627;0.0207896609433460,0.00400176049795692,-0.0344837531821133,0.0104721889799973,0.0443180766647906,-0.0522994137753644,-0.0364609102513709,-8.92873816417214e-05,0.734860477722698,-0.0112858722683411,-0.0184463097259200,0.0507236441880169,-0.0474911786132233,-0.0489324123147103,-0.00729040142132915,0.00165229601409822,0.00548134539473958,-0.0317206291660227,0.0355339407258206,0.0120237315861502;0.00508436638023531,-0.0204350147636192,0.0374653251663720,0.0133967106024553,-0.0194989877057597,-0.0290615207191115,0.0206771746014384,-0.00796683593637815,-0.0112858722683412,0.756960243722405,0.0771415290787563,-0.0449484626181886,-0.0206483867489690,-0.0377593520892349,0.00643010736944419,-0.00579195447546731,-0.0573170917816033,0.0432052194350660,-0.0375127467895433,-0.0344669539988356;0.0237489918633488,0.0326036734521642,-0.0264750167707198,-0.0117987612086818,-0.00405208239440866,0.0135915042541649,0.0465629257476976,-0.0719995309657637,-0.0184463097259198,0.0771415290787563,0.793380321577470,-0.0244816509348841,-0.0379464020648399,0.0233993717393387,-0.0378653913551843,0.00689960112439084,-0.0561756323297161,-0.00858042410449981,-0.00580897728694144,-0.0559674042051105;0.0229805598224597,0.0112604290246016,0.00692674742366469,0.0567671128294101,-0.0522322968159025,0.0736167902704775,0.00757867168316328,0.00894766976668678,0.0507236441880148,-0.0449484626181898,-0.0244816509348825,0.800544140987525,-0.0391178207423304,-0.0316639473909092,0.0554946995299906,-0.0135367191309779,0.0350081971610129,-0.0569608821062648,0.000285872569055281,-0.00618057361024999;-0.0256881818399135,0.0331586867288118,0.0130271097958450,-0.0212458361999647,0.0220172586733878,0.0376629751366736,0.0282870459266204,0.0616906683279444,-0.0474911786132221,-0.0206483867489681,-0.0379464020648403,-0.0391178207423326,0.743773698106044,0.0107473341123817,0.0140090197482492,-0.0114622063413605,0.0117985519961890,-0.00228719934576301,0.0353191463882868,0.0334927594290729;-0.0181343192477095,-0.0231725467546926,0.0479632523770243,-0.0313781868274025,-0.0850471706870611,-0.0273395076943703,-0.0297404558552754,-0.0371345351632839,-0.0489324123147090,-0.0377593520892342,0.0233993717393377,-0.0316639473909091,0.0107473341123806,0.749465935045672,0.000109435903820661,-0.0719659573369054,-0.0341164490111516,-0.0146116872615744,0.0473373960847527,0.0409398368317565;-0.0305655493993886,0.00937551377822010,0.0586037002111310,-0.0190482911045130,-0.0334446383023932,0.00585139759363266,0.0248739038023485,0.0372283671052187,-0.00729040142132820,0.00643010736944447,-0.0378653913551849,0.0554946995299905,0.0140090197482484,0.000109435903820639,0.812387125636978,-0.0241145589789979,-0.0404206858792873,0.0648465176228971,0.0423255986626977,0.0121840676107235;-0.0115753537276011,0.0244296449704629,-0.0342445646940760,0.0185543968177528,-0.0627971336354350,0.00547756061636374,0.0320447684194614,0.0220876934822290,0.00165229601409811,-0.00579195447546747,0.00689960112439089,-0.0135367191309774,-0.0114622063413608,-0.0719659573369061,-0.0241145589789984,0.752534779946756,0.0250595030699008,0.0376601610904065,0.0506750733537145,-0.0118768276989352;-0.0176433485443872,0.00708819660465868,-0.0133067557026467,0.0201793870142969,-0.0473616225124357,0.0393124336369899,-0.00464030451874604,0.00293394752607496,0.00548134539473935,-0.0573170917816031,-0.0561756323297161,0.0350081971610140,0.0117985519961876,-0.0341164490111521,-0.0404206858792884,0.0250595030699007,0.665498168983354,-0.0176049143493559,-0.0519784809103602,-0.0498633270865927;0.00304972372985174,-0.0153031767115631,-0.0211881346865084,0.0396527240135015,-0.0612106258992936,-0.0459067421577423,0.0711983673780022,0.0588384971652738,-0.0317206291660232,0.0432052194350650,-0.00858042410449966,-0.0569608821062651,-0.00228719934576220,-0.0146116872615745,0.0648465176228969,0.0376601610904063,-0.0176049143493567,0.753282097259083,0.0316662196739387,0.00635107013403636;0.00191747464835604,0.0156570068722790,-0.0175962888840353,-0.0261878753826539,0.0316533076712675,-0.0566248412160512,-0.0125983901701052,0.0178173983232493,0.0355339407258210,-0.0375127467895426,-0.00580897728694204,0.000285872569057908,0.0353191463882845,0.0473373960847516,0.0423255986626970,0.0506750733537146,-0.0519784809103599,0.0316662196739400,0.744153391589339,0.0492612313778822;-0.00975794992696336,-0.0226098767449005,0.0211709306347597,-0.0339590319344975,0.00595715825206498,-0.0719168363652852,-0.0450882800177320,0.0205272541717639,0.0120237315861489,-0.0344669539988365,-0.0559674042051094,-0.00618057361025206,0.0334927594290760,0.0409398368317580,0.0121840676107247,-0.0118768276989359,-0.0498633270865938,0.00635107013403534,0.0492612313778806,0.663976340641261];
   s = [-30,29,79,-67,94,-6,14,-70,82,-72,32,24,44,-49,64,-94,-98,-32,32,-19];
   x = (x+s)*M;
else
end
f = @(x) zigzag(x,k,m,lmbd).*3.*(abs(log(abs(x)*1000+1)))+30-30*abs(cos(x/(pi*10)));

val = zeros(n,1);
for i=1:n
    val(i) = sum(f(f(x(i,:))));
end

end

function [valz] = zigzag(xs,k,m,lmbd)
    valz = zeros(size(xs));
    xs = abs(xs); 
    xs = xs/k - floor(xs/k);
    ids = xs<=lmbd;
    valz = 1-m+ids*m.*(xs/lmbd) + (1-ids).*m.*(1-(xs-lmbd)/((1-lmbd)));
end

