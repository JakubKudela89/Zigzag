function [val] = F3(x,k,m,lmbd)
% F3 benchmark function with values of M and s
% x can be an n times d matrix, with n points in dimension d
[n,d] = size(x); 
if d == 1

elseif d == 2
    M = [0.724494251590697,-0.158624293816072;-0.158624293816072,0.908670992406059];
    s = [-74,-76]; x = (x+s)*M;
elseif d == 5
   M = [0.864677950057979,-0.0270875946621475,0.0105892403772711,-0.123798901490413,0.0194776238753320;-0.0270875946621480,0.795778178140080,-0.00366305206247432,-0.0159819305678109,-0.0760065328515233;0.0105892403772713,-0.00366305206247493,0.765745027086012,0.0140714231898137,0.0258615119264102;-0.123798901490413,-0.0159819305678109,0.0140714231898133,0.869262121436178,-0.0261823831062540;0.0194776238753327,-0.0760065328515241,0.0258615119264101,-0.0261823831062532,0.831426272105607];
   s = [-13,-1,69,-86,13];   x = (x+s)*M;
elseif d == 10
   M = [0.789403043509946,0.0662629646013468,-0.0891832479991405,0.0141044930057966,0.0259618092547494,-0.0343863817187448,-0.0316628891193835,-0.00312370206728746,-0.0274310771449971,-0.0566982578276342;0.0662629646013459,0.792150505835546,0.0192597328308000,-0.0420625522554516,-0.0295755271654099,-0.0282396658094097,-0.0969328999628731,-0.0254493586639372,-0.0655315102112905,-0.0842352094505540;-0.0891832479991407,0.0192597328308010,0.839094123531589,0.0631684788338559,-0.0250029424413529,-0.0946870008022666,0.0219606086102626,-0.0343894491017203,0.00990462831842893,-0.0408481833878537;0.0141044930057959,-0.0420625522554515,0.0631684788338552,0.874597998387849,-0.0158456278753481,-0.0365789422855823,-0.00469278861113803,-0.000449415347931902,0.00416479793094637,-0.0213320530219604;0.0259618092547514,-0.0295755271654109,-0.0250029424413505,-0.0158456278753485,0.795922044896291,-0.0567282592423976,-0.0159898737138701,0.0729993941069172,-0.0140530425759419,0.00354654769145130;-0.0343863817187455,-0.0282396658094086,-0.0946870008022670,-0.0365789422855820,-0.0567282592423986,0.783657816964774,0.0154237690721584,-0.0506416955625058,-0.0167158474178535,0.0163502720733377;-0.0316628891193830,-0.0969328999628731,0.0219606086102627,-0.00469278861113824,-0.0159898737138701,0.0154237690721582,0.882619907239457,0.000768590439031886,-0.0729312745490576,-0.0273061119657210;-0.00312370206728934,-0.0254493586639358,-0.0343894491017216,-0.000449415347931099,0.0729993941069168,-0.0506416955625067,0.000768590439032011,0.926091270919121,0.00355542502261884,-0.0105465351707686;-0.0274310771449963,-0.0655315102112914,0.00990462831842953,0.00416479793094592,-0.0140530425759413,-0.0167158474178534,-0.0729312745490575,0.00355542502261854,0.920032309623006,-0.0149846074451164;-0.0566982578276340,-0.0842352094505540,-0.0408481833878537,-0.0213320530219603,0.00354654769145121,0.0163502720733376,-0.0273061119657213,-0.0105465351707685,-0.0149846074451164,0.834842613605161];
   s = [-62,-20,-67,19,-48,-73,-9,-43,-52,-97];  x = (x+s)*M;
elseif d == 15
   M = [0.752578566000700,-0.0312348890216375,-0.0450446799450322,0.00388319525352686,-0.0526998166998492,-0.0415293730720855,0.0109934742286210,-0.0485853188363549,-0.0232001046164653,0.0483396968439685,-0.0643003473242328,-0.0430874653593557,0.0201067502954921,0.0347815782299117,0.0519064791020679;-0.0312348890216364,0.837287865487775,0.00378734296261048,-0.0404391635475338,0.00163129771387036,-0.00903572702124341,-0.0146206168919915,0.0323635087263232,-0.00275867293863838,0.0481011292564286,0.00926108970699287,-0.00758248397295611,0.0173732465112023,0.0173936969419772,-0.0144257456073208;-0.0450446799450334,0.00378734296261136,0.906460964892553,0.0438987627001417,-0.00506825891557175,-0.0474935437318867,0.0147703887496475,0.0141476626780682,0.0231616051596372,-0.0568915865512053,0.0441736810643680,-0.0328889430521147,0.0800220824004322,0.0720565765952303,0.0433921535599283;0.00388319525352822,-0.0404391635475346,0.0438987627001419,0.813787335497955,-0.0304193065284944,-0.0422411521993870,-0.0220209737120882,-0.0679805934171197,0.0196307602738889,0.0141111123091088,-0.00180961367223144,0.0745411242560748,-0.0201821785146591,0.0432528240110886,-0.0650014528102324;-0.0526998166998494,0.00163129771387051,-0.00506825891557203,-0.0304193065284946,0.723583611014560,-0.0379327799203332,0.0153445692679465,-0.0130718922216168,0.00316401250903899,-0.0763208317614855,-0.0387820314260520,0.0154597461176042,-0.0233570988874933,-0.00209236240567983,-0.0254401191083436;-0.0415293730720871,-0.00903572702124236,-0.0474935437318875,-0.0422411521993872,-0.0379327799203332,0.849318866033214,-0.0110953033982684,0.0209434224988347,0.0492776444687575,-0.0220401781967880,-0.0160779598668712,0.0760944486155717,0.0925348464978807,-0.0256634995908997,0.0259847571257223;0.0109934742286213,-0.0146206168919918,0.0147703887496471,-0.0220209737120879,0.0153445692679463,-0.0110953033982686,0.681446583179809,0.00551680894458848,-0.0574990494612899,-0.0119513620755661,-0.00416081395101062,0.0456134600155623,0.0147924310343957,0.00812575184726637,0.0153761496270346;-0.0485853188363562,0.0323635087263241,0.0141476626780681,-0.0679805934171198,-0.0130718922216165,0.0209434224988351,0.00551680894458844,0.839574052151619,0.0110996729925351,0.00270342656726986,0.0148675633553991,-0.0407350168034547,-0.0310360186384546,0.00768784112633748,0.0448101082990403;-0.0232001046164661,-0.00275867293863812,0.0231616051596364,0.0196307602738894,0.00316401250903913,0.0492776444687565,-0.0574990494612897,0.0110996729925345,0.794496823638565,-0.0768632467588300,-0.00497281952829000,-0.0266113803935584,0.00370909747446902,-0.0534863109396082,-0.0217076766430739;0.0483396968439694,0.0481011292564281,-0.0568915865512053,0.0141111123091088,-0.0763208317614853,-0.0220401781967881,-0.0119513620755661,0.00270342656727017,-0.0768632467588304,0.744372952551824,0.0299791665781266,-0.0362255832521483,-0.0107674109900936,0.0240974808006575,0.00260617417946847;-0.0643003473242343,0.00926108970699424,0.0441736810643689,-0.00180961367223275,-0.0387820314260515,-0.0160779598668694,-0.00416081395101097,0.0148675633554002,-0.00497281952828876,0.0299791665781260,0.735475288638912,-0.0645591037823398,0.0183789956822412,-0.0560910291375007,-0.0273688017172951;-0.0430874653593564,-0.00758248397295535,-0.0328889430521144,0.0745411242560741,0.0154597461176044,0.0760944486155726,0.0456134600155622,-0.0407350168034541,-0.0266113803935578,-0.0362255832521487,-0.0645591037823398,0.799955953212700,0.0446720871674006,0.0179273134794590,-0.0169887082195875;0.0201067502954928,0.0173732465112013,0.0800220824004314,-0.0201821785146578,-0.0233570988874938,0.0925348464978792,0.0147924310343967,-0.0310360186384557,0.00370909747446795,-0.0107674109900928,0.0183789956822407,0.0446720871674004,0.708120669612421,0.0153132125961141,0.0262997194405570;0.0347815782299122,0.0173936969419766,0.0720565765952306,0.0432528240110884,-0.00209236240567953,-0.0256634995908990,0.00812575184726667,0.00768784112633792,-0.0534863109396085,0.0240974808006572,-0.0560910291375000,0.0179273134794595,0.0153132125961136,0.748769460807061,0.0209078434935361;0.0519064791020678,-0.0144257456073208,0.0433921535599274,-0.0650014528102317,-0.0254401191083438,0.0259847571257216,0.0153761496270351,0.0448101082990396,-0.0217076766430743,0.00260617417946905,-0.0273688017172963,-0.0169887082195877,0.0262997194405574,0.0209078434935363,0.722340346446400];
   s= [26,98,47,91,-18,-56,13,-94,1,77,-100,73,-50,-31,-4]; x = (x+s)*M;
elseif d == 20
   M = [0.759056457149936,-0.0911085638935970,-0.0262235714826437,-0.0138269315030905,-0.0214949778138553,-0.0406253435934212,0.0118597306347661,0.0197954070149765,0.0299023593662195,-0.00438039657081361,-0.0205707655708201,0.0431668801569905,-0.0197902188199268,0.0440418919269185,0.0478833363438122,0.0157557257564750,0.0618941932711878,-0.0155297006673240,0.0139410781305221,0.0717323031287852;-0.0911085638935957,0.821992689879767,-0.0171642160998866,-0.00259288669129007,0.0116302779532408,-0.00350125132191115,-0.0181569691831508,-0.0239291031345868,-0.0117883322697753,-0.00222341242841523,0.0590019986995557,-0.0157813093393137,0.0401693598722065,0.0369809437108196,0.0133620141639723,0.0125080728498459,0.0254302463425969,-0.0142262521664900,0.0348307591383319,0.0473516286148586;-0.0262235714826432,-0.0171642160998851,0.754122620248256,0.0478489854124639,0.0227434582937846,-0.0155715000428027,-0.0350587068600181,-0.0474750624663466,0.00615737401682565,-0.0171399277272773,0.0977985090839350,-0.0495116286796622,0.0168572706847679,0.0109816892770656,0.0355253720290217,0.0139666569258669,0.0171677913919601,0.00671350824142341,0.00957875170550861,-0.0284472194505416;-0.0138269315030901,-0.00259288669129044,0.0478489854124635,0.836125479598809,-0.00221774289925724,-0.00639313968094443,-0.00793161240714977,0.0536493305536547,0.0141102541256622,-0.0512500689346628,-0.0280344649780764,0.0208579064141840,-0.0384546960542760,-0.000960969674395653,-0.0536582128987620,-0.0212771920991910,0.0174808976280769,0.0279274238968455,-0.00128666500729930,-0.0479100864344641;-0.0214949778138544,0.0116302779532413,0.0227434582937844,-0.00221774289925716,0.775546068072182,0.0315187659461351,-0.0148024040418115,0.00328305635433039,0.0360101185829850,-0.0585625830202615,-0.0132608107596355,-0.00239152240405393,-0.0106852861888317,0.000651272623422594,-0.0356183305622125,-0.0875995506222918,0.0630543803740931,-0.0444394829539633,0.0561166463258983,-0.0369194359072849;-0.0406253435934220,-0.00350125132191039,-0.0155715000428023,-0.00639313968094411,0.0315187659461354,0.709966369570124,0.0238232672737149,-0.0556608849168038,-0.000590722656839803,-0.0449452077027650,-0.0342139642967654,-0.0281810555020439,0.0127773923638184,0.0282379237915393,0.0185725413640505,0.0343079582069025,0.0428444996329450,-0.0270920338944905,0.0327092691992792,-0.0258962861272053;0.0118597306347665,-0.0181569691831518,-0.0350587068600183,-0.00793161240715001,-0.0148024040418113,0.0238232672737162,0.770558876604270,0.00167530704048682,0.0354190235937284,0.0517339020406965,0.0566737556327037,-0.000232302909473004,-0.00112579971120901,-0.0236712756972823,-0.0505892705917188,0.0295100790692115,0.0167341159202523,-0.0392001495035970,-0.0284028303576801,-0.000522694364355883;0.0197954070149762,-0.0239291031345869,-0.0474750624663463,0.0536493305536550,0.00328305635433037,-0.0556608849168032,0.00167530704048743,0.835044736643511,0.0225700958606226,0.0201285448906189,0.0225757077331194,-0.0400220403593859,0.0490409176948811,0.0216368076878574,0.0257629410590033,0.0359828899020779,0.00169431849259759,0.000397203426993290,0.00435987507142523,-0.0432561214683150;0.0299023593662184,-0.0117883322697750,0.00615737401682623,0.0141102541256622,0.0360101185829855,-0.000590722656839318,0.0354190235937289,0.0225700958606223,0.710711540034045,0.0687687883375557,-0.00932097412385249,0.0174544310397161,0.0490270173005560,0.0353465884348849,0.00106948503467045,-0.0823549752974922,-0.0326663786015821,0.0355624505824990,0.0319666855305932,0.0536083642749125;-0.00438039657081402,-0.00222341242841526,-0.0171399277272767,-0.0512500689346631,-0.0585625830202621,-0.0449452077027649,0.0517339020406965,0.0201285448906193,0.0687687883375554,0.814113123041731,-0.000605607242560123,0.0143760528209915,0.0108508056034327,0.0134283833298433,-0.0207324924430211,-0.0342222102057489,0.00853775905031115,-0.0392219885420554,0.0122644647905671,-0.0554874169995977;-0.0205707655708194,0.0590019986995565,0.0977985090839349,-0.0280344649780767,-0.0132608107596349,-0.0342139642967658,0.0566737556327040,0.0225757077331187,-0.00932097412385381,-0.000605607242560549,0.835133762382691,0.00567670526640832,-0.0286939514034660,0.0202718778799439,-0.0653535716129843,0.0362831753462252,-0.00794100236623760,0.0149079151103556,-0.00436526581566579,-0.00933574441558012;0.0431668801569908,-0.0157813093393138,-0.0495116286796620,0.0208579064141834,-0.00239152240405375,-0.0281810555020443,-0.000232302909473221,-0.0400220403593858,0.0174544310397159,0.0143760528209928,0.00567670526640817,0.808857945107445,0.0113222443881019,0.0478062070856750,0.00429218711783665,0.0188935634897918,0.00899766980062675,0.0332323507702412,0.0257617664383641,-0.0633682406223208;-0.0197902188199273,0.0401693598722063,0.0168572706847675,-0.0384546960542755,-0.0106852861888318,0.0127773923638193,-0.00112579971120808,0.0490409176948808,0.0490270173005563,0.0108508056034318,-0.0286939514034658,0.0113222443881021,0.838133074512573,-0.0459684173992898,-0.0341403896525205,0.00317071468296165,0.0335617026149511,-0.0270745025055348,-0.0300106715501801,-0.00965005562669815;0.0440418919269180,0.0369809437108193,0.0109816892770653,-0.000960969674395905,0.000651272623422516,0.0282379237915400,-0.0236712756972827,0.0216368076878575,0.0353465884348861,0.0134283833298430,0.0202718778799438,0.0478062070856754,-0.0459684173992892,0.887238651720280,-0.00734240138255809,-0.0511206083388256,-0.0106793736509774,-0.00219344907153392,-0.0225748118150015,0.00814959667993270;0.0478833363438125,0.0133620141639711,0.0355253720290209,-0.0536582128987621,-0.0356183305622125,0.0185725413640511,-0.0505892705917183,0.0257629410590032,0.00106948503467159,-0.0207324924430210,-0.0653535716129847,0.00429218711783770,-0.0341403896525212,-0.00734240138255822,0.826886156686546,-0.0197586923736761,-0.0401653541391577,0.00854447890262531,-0.0191134859118541,-0.00658140123248137;0.0157557257564748,0.0125080728498473,0.0139666569258672,-0.0212771920991902,-0.0875995506222924,0.0343079582069017,0.0295100790692112,0.0359828899020773,-0.0823549752974935,-0.0342222102057488,0.0362831753462255,0.0188935634897913,0.00317071468296169,-0.0511206083388262,-0.0197586923736765,0.791253962258632,0.0143238107884359,-0.00764389166533113,0.0359918700914244,-0.0275295216876602;0.0618941932711882,0.0254302463425973,0.0171677913919598,0.0174808976280773,0.0630543803740928,0.0428444996329447,0.0167341159202524,0.00169431849259768,-0.0326663786015819,0.00853775905031100,-0.00794100236623777,0.00899766980062621,0.0335617026149517,-0.0106793736509770,-0.0401653541391570,0.0143238107884349,0.757041991693181,0.0194556833573915,-0.0538634685073110,0.0185086348228659;-0.0155297006673248,-0.0142262521664906,0.00671350824142362,0.0279274238968455,-0.0444394829539627,-0.0270920338944903,-0.0392001495035974,0.000397203426993653,0.0355624505825000,-0.0392219885420562,0.0149079151103562,0.0332323507702410,-0.0270745025055354,-0.00219344907153415,0.00854447890262516,-0.00764389166533107,0.0194556833573906,0.841210215748551,-0.0128648183806749,-0.0154372174120937;0.0139410781305220,0.0348307591383305,0.00957875170550893,-0.00128666500729976,0.0561166463258982,0.0327092691992790,-0.0284028303576819,0.00435987507142536,0.0319666855305930,0.0122644647905679,-0.00436526581566649,0.0257617664383630,-0.0300106715501802,-0.0225748118150006,-0.0191134859118549,0.0359918700914242,-0.0538634685073108,-0.0128648183806744,0.832051009536494,0.0139510973881100;0.0717323031287847,0.0473516286148590,-0.0284472194505415,-0.0479100864344641,-0.0369194359072845,-0.0258962861272057,-0.000522694364354915,-0.0432561214683147,0.0536083642749127,-0.0554874169995977,-0.00933574441557939,-0.0633682406223207,-0.00965005562669826,0.00814959667993217,-0.00658140123248150,-0.0275295216876601,0.0185086348228658,-0.0154372174120944,0.0139510973881098,0.784092131430161];
   s = [61,96,-97,-80,65,15,-28,68,-11,95,-48,-63,53,9,-84,26,88,7,31,3];
   x = (x+s)*M;
else
    
end
f = @(x) zigzag(x,k,m,lmbd).*3.*(abs(log(abs(x)*1000+1)))+30-30*abs(cos(x/(pi*10)));

val = zeros(n,1);
for i=1:n
    val(i) = sum(f(x(i,:)));
end

end

function [valz] = zigzag(xs,k,m,lmbd)
    valz = zeros(size(xs));
    xs = abs(xs); 
    xs = xs/k - floor(xs/k);
    ids = xs<=lmbd;
    valz = 1-m+ids*m.*(xs/lmbd) + (1-ids).*m.*(1-(xs-lmbd)/((1-lmbd)));
end

