function [val] = F2(x,k,m,lmbd)
% F2 benchmark function with values of M and s
% x can be an n times d matrix, with n points in dimension d
[n,d] = size(x); val = 0; 
if d == 1
    M = 1; s = 0; x = (x+s)*M;
elseif d == 2
    M = [0.999481402986611,-0.007602368169921;-0.007602368169921,0.888553153414160];
    s = [-92,-53]; x = (x+s)*M;
elseif d == 5
   M = [0.819021188650414,-0.0354336226959924,0.126547808685950,0.0437439223819181,0.0390431756677374;-0.0354336226959934,0.848097406955661,0.141990515498945,-0.0401135264563379,0.0257277641665964;0.126547808685950,0.141990515498946,0.671014730193396,-0.0890643234564865,0.00690648805467870;0.0437439223819179,-0.0401135264563378,-0.0890643234564867,0.907391753444572,0.0287516539537509;0.0390431756677365,0.0257277641665962,0.00690648805467811,0.0287516539537506,0.841051079159389];
   s = [26,-30,80,0,8];   x = (x+s)*M;
elseif d == 10
   M = [0.880801063979121,-0.0349705809277844,0.00614781863557734,0.0287245242638531,0.0862666338363308,0.0636164259534003,-0.00343879988396492,-0.0306308865545579,0.00428954883732066,0.0179966091039461;-0.0349705809277861,0.771074653078407,0.0801015294558480,-0.0244281187799114,0.0526608889501404,0.0405249003169389,-0.0353479263852661,-0.0357960386189722,0.113968681894177,-0.0189737407926144;0.00614781863557711,0.0801015294558461,0.922136503910876,0.0160368607714883,-0.0264443125424801,-0.0835324383527202,0.0331859726213911,0.00181978397462964,-0.00512154062053647,0.0171025343190509;0.0287245242638531,-0.0244281187799118,0.0160368607714881,0.867468676623493,-0.0195266572737396,-0.0130635166866800,-0.0643452388241320,0.0168199589066645,-0.00341815781407314,0.0426798774946197;0.0862666338363314,0.0526608889501418,-0.0264443125424798,-0.0195266572737396,0.828632707758968,-0.0167735192260916,-0.0174362101155752,0.112664468066399,-0.0446316013846518,-0.0389740343626447;0.0636164259534003,0.0405249003169396,-0.0835324383527197,-0.0130635166866802,-0.0167735192260921,0.723455586048969,0.0593325829517508,-0.00661507066754346,0.0299201239093939,0.0470421867053015;-0.00343879988396528,-0.0353479263852658,0.0331859726213916,-0.0643452388241315,-0.0174362101155755,0.0593325829517503,0.797224108078280,0.0393422376026970,0.00325795630816747,0.0651002097001942;-0.0306308865545585,-0.0357960386189715,0.00181978397463004,0.0168199589066644,0.112664468066399,-0.00661507066754325,0.0393422376026973,0.810635265602421,-0.00391490495395637,0.0149100204365087;0.00428954883731934,0.113968681894176,-0.00512154062053500,-0.00341815781407313,-0.0446316013846530,0.0299201239093932,0.00325795630816745,-0.00391490495395690,0.848905180670682,-0.00266536081780197;0.0179966091039457,-0.0189737407926140,0.0171025343190518,0.0426798774946197,-0.0389740343626449,0.0470421867053015,0.0651002097001943,0.0149100204365082,-0.00266536081780111,0.857769002712118];
   s = [80,-53,35,21,-45,94,-45,-92,67,14];  x = (x+s)*M;
elseif d == 15
   M = [0.755020397930859,-0.0437445888209896,-0.00287752256186023,0.0177914570231765,-0.0291431584689100,-0.0115240922558290,-0.0491458107143891,0.0306259147857410,-0.0486702472541766,0.0253156623461154,0.0477170799971338,0.0226018409788204,0.0641446696062568,-0.00529087674281376,-0.0553878656543942;-0.0437445888209898,0.897324319740987,-0.0374121351888543,0.0583442025151557,-0.0431925550890389,0.0479165685125066,-0.0316792750098995,-0.0220479917989120,-0.0109020994744917,0.0198465958420884,0.00423589239122917,-0.00301939052321348,-0.0140592297771541,-0.0455731366642312,0.0296423452849493;-0.00287752256185968,-0.0374121351888546,0.796432497495927,-0.00866332089016907,-0.0595400087071440,-0.0495205526704853,0.0132526274958962,-0.0979468925415856,-0.0714963774467730,-0.0108005541002738,0.0385670902124613,-0.0167690715566150,-0.0696368272648719,0.0133227007029091,-0.0364238534983716;0.0177914570231761,0.0583442025151562,-0.00866332089016850,0.701862791550569,-0.0647623789155529,0.00220354813569256,0.0388616911315671,0.0131388117439834,-0.00230414779321956,0.0762850719660475,0.00636478870949159,0.0243691350178105,-0.0317711768135293,0.0121391690730947,-0.0263282882628460;-0.0291431584689103,-0.0431925550890388,-0.0595400087071430,-0.0647623789155535,0.842340319292199,0.0973840465856954,0.0222338405829732,-0.0502511246567226,-0.0229735356643118,0.0572254522072379,0.0176946409396759,-0.0101082099851930,0.0248805684984677,0.00537117965902127,0.0208770047759177;-0.0115240922558283,0.0479165685125067,-0.0495205526704859,0.00220354813569303,0.0973840465856952,0.774643788599130,0.0318389444051225,-0.00496288907110166,-0.0384139998180506,-0.00768977325480425,-0.0364980938034354,-0.00453775786798408,0.0159764628563368,-0.0357385774969090,-0.102681655370620;-0.0491458107143881,-0.0316792750099001,0.0132526274958957,0.0388616911315672,0.0222338405829720,0.0318389444051230,0.790789345374571,0.0380312088213762,0.00494576476817764,0.0265123995712073,-0.0421436806645836,0.0550136298112767,-0.0697818980717957,-0.0509266986528210,0.0164932615757692;0.0306259147857419,-0.0220479917989122,-0.0979468925415867,0.0131388117439847,-0.0502511246567237,-0.00496288907110163,0.0380312088213746,0.819192705146538,-0.0325593734780148,0.00871145944413261,-0.0581490232128747,-0.0306639415702290,0.00862300055037616,0.0269477954654675,0.0437206726427723;-0.0486702472541769,-0.0109020994744918,-0.0714963774467727,-0.00230414779321951,-0.0229735356643113,-0.0384139998180510,0.00494576476817739,-0.0325593734780154,0.919831682304764,-0.0134356387966650,-0.0199205047060726,0.0460255595387684,-0.0534971354356137,0.0172334466453405,-0.0254953203255892;0.0253156623461142,0.0198465958420885,-0.0108005541002727,0.0762850719660475,0.0572254522072393,-0.00768977325480483,0.0265123995712082,0.00871145944413186,-0.0134356387966648,0.788086005229156,0.0611643599994520,-0.0167694350421125,-0.0477860949515103,0.0946338842440509,0.0127143902199841;0.0477170799971335,0.00423589239122928,0.0385670902124619,0.00636478870949101,0.0176946409396758,-0.0364980938034356,-0.0421436806645830,-0.0581490232128744,-0.0199205047060729,0.0611643599994512,0.706128136695216,0.0450128159088460,-0.00480268004065872,0.0382570422187076,0.0204043557234050;0.0226018409788200,-0.00301939052321325,-0.0167690715566138,0.0243691350178095,-0.0101082099851925,-0.00453775786798423,0.0550136298112777,-0.0306639415702294,0.0460255595387680,-0.0167694350421130,0.0450128159088461,0.845471960906068,0.0481547329652974,-0.0544116594374977,0.0133273275167490;0.0641446696062556,-0.0140592297771540,-0.0696368272648709,-0.0317711768135294,0.0248805684984685,0.0159764628563365,-0.0697818980717951,0.00862300055037444,-0.0534971354356143,-0.0477860949515098,-0.00480268004065800,0.0481547329652983,0.751734599666170,-0.0544889735307147,0.0400142416065521;-0.00529087674281441,-0.0455731366642309,0.0133227007029099,0.0121391690730952,0.00537117965902200,-0.0357385774969095,-0.0509266986528212,0.0269477954654669,0.0172334466453402,0.0946338842440512,0.0382570422187083,-0.0544116594374971,-0.0544889735307143,0.733102570111021,-0.0196923029801835;-0.0553878656543945,0.0296423452849493,-0.0364238534983706,-0.0263282882628470,0.0208770047759176,-0.102681655370620,0.0164932615757704,0.0437206726427735,-0.0254953203255897,0.0127143902199828,0.0204043557234050,0.0133273275167478,0.0400142416065510,-0.0196923029801842,0.867101778249458];
   s= [18,27,-17,95,1,82,59,-37,12,99,-6,1,34,80,30]; x = (x+s)*M;
elseif d == 20
   M = [0.825221364333956,0.0494521822421463,-0.0480553415910917,0.00406600609255396,0.0184168114409708,0.000229122412370689,-0.0491039923811413,-0.00118036015992475,0.0253668784843869,-0.0293952753720157,-0.0318473356023936,0.0452263414781110,0.0399114037667863,-0.00699170601168450,-0.0274322501828818,0.0195318365354916,-0.0321114922656208,-0.0277608095270928,-0.0108329647766994,-0.0313653239732500;0.0494521822421410,0.850539010778783,-0.0161160381800991,-0.00149369734245380,-0.0411683763414898,-0.0190910180189161,0.00304640498212413,-0.0159976084350688,0.0838796548050694,0.0155916877512140,-0.0118443067625969,-0.0319597680934087,-0.0498230234116089,0.0343868277394413,0.0143453857243577,-0.0226454750493537,-0.0306908483144164,0.0101133386305162,-0.00642336495812185,0.0320716648153558;-0.0480553415910721,-0.0161160381801268,0.718238520377534,0.0292836276122377,0.00685429506294748,-0.0114873933438619,-0.00254461550617399,0.0153511264444743,-0.0289624081271975,-0.0102455152339149,0.0170731051981478,-0.0153784796730336,0.00110519602957917,-0.00510971072701317,0.0334828518971100,0.0288293753833834,0.0590771999756425,0.0555044137290272,-0.0109469984697327,-0.00438121382529465;0.00406600609254789,-0.00149369734245106,0.0292836276122627,0.841045756707167,0.0708713216414216,0.000715677752139246,-0.00278169372952703,-0.0328014992875059,0.0300942184560793,0.00597737232512672,0.0250627695018200,-0.0643135161913968,-0.0101874991811997,0.00399664881037052,0.0229404386789611,-0.00665152436828824,0.00296457023852673,0.0271678453723090,0.0345402241147609,-0.0230233937130401;0.0184168114409758,-0.0411683763414978,0.00685429506295017,0.0708713216414144,0.785442043567716,-0.000947414517342710,-0.000554443341495700,-0.0224432140570822,0.0129508523370273,-0.0260076068218745,0.00153008395262892,-0.0353318842664735,0.0100335153157728,-0.0480461575242604,0.0369985687359796,0.0262519874355980,-0.00154914201904340,0.0308883195578799,-0.0106460352104567,0.0127719109801512;0.000229122412378521,-0.0190910180189256,-0.0114873933438664,0.000715677752130760,-0.000947414517345233,0.801020075336897,-0.00578017123433094,0.00435768395889029,-0.00577052083513201,-0.00868475590084557,-0.0192080160611528,0.00433632314636834,0.0280503155352441,-0.00714094678711796,0.0113016498056122,0.0524041085615062,0.0101051141829551,0.0301266580699779,-0.0128447271075562,0.000519920964554733;-0.0491039923811670,0.00304640498215429,-0.00254461550614841,-0.00278169372950230,-0.000554443341485420,-0.00578017123432648,0.715097513710610,-0.00491388155829923,0.00555953969121107,-0.0313849471515802,0.0305378033222952,-0.00577638247956153,-0.0386205756871725,0.0169609280254355,-0.0373934947873765,0.0222300873224899,0.0440603957750389,-0.00651294121242101,-0.00420374073747930,0.0198075735708582;-0.00118036015993134,-0.0159976084350600,0.0153511264444759,-0.0328014992874987,-0.0224432140570808,0.00435768395888944,-0.00491388155829297,0.762774891801080,-0.0425641005848705,-0.0337143145625647,0.0313115949225294,0.0100792485405117,-0.0112072764908323,-0.0162852958871952,-0.0202310875052183,0.00133600742018587,0.00158295620337446,0.0152485581595777,-0.0220805527361420,0.00180876032808768;0.0253668784843974,0.0838796548050635,-0.0289624081272321,0.0300942184560766,0.0129508523370174,-0.00577052083514343,0.00555953969124234,-0.0425641005848601,0.763175946698849,-0.0396207152569619,-0.00792953972082219,-0.0175785687994272,0.0176486784834430,0.00180709670452370,-0.0113117506722571,-0.0116846267825315,-0.0339810836420460,0.0131768428263991,-0.0302368596460463,-0.0186422857530658;-0.0293952753720220,0.0155916877512242,-0.0102455152339210,0.00597737232513642,-0.0260076068218749,-0.00868475590084963,-0.0313849471515640,-0.0337143145625617,-0.0396207152569762,0.777810600902921,0.0519660780594147,0.00357111953138782,0.0471113720468905,0.0388621483308350,-0.0161079865219949,-0.0390900074356015,-0.00361404282407470,0.0415484759149554,-0.0296353305326931,0.0377897473257289;-0.0318473356023831,-0.0118443067626048,0.0170731051981214,0.0250627695018148,0.00153008395262064,-0.0192080160611608,0.0305378033223166,0.0313115949225372,-0.00792953972081804,0.0519660780594263,0.786308898357088,0.0181973822362905,0.0221709066596637,-0.0393702020936331,-0.0410443308888551,-0.0372469713964561,-0.00638592330278787,0.0243056307455476,0.0336035853070146,0.0141452972708465;0.0452263414781060,-0.0319597680934086,-0.0153784796730093,-0.0643135161913988,-0.0353318842664668,0.00433632314637738,-0.00577638247958794,0.0100792485405040,-0.0175785687994219,0.00357111953137911,0.0181973822362974,0.788056962517942,0.0189547233576102,0.0329701557419370,-0.0464413772964746,0.0156486062566667,-0.00946310220329517,0.0442081474937030,-0.0300404969909652,0.00724437683505047;0.0399114037667811,-0.0498230234116067,0.00110519602959873,-0.0101874991811992,0.0100335153157788,0.0280503155352511,-0.0386205756871917,-0.0112072764908383,0.0176486784834445,0.0471113720468825,0.0221709066596674,0.0189547233576119,0.890172190373632,-0.00185085181818889,0.0288098970787948,-0.0234488425242711,-0.0281423655796546,0.000386811078877416,0.00163874801183604,-0.0189331007686518;-0.00699170601167860,0.0343868277394374,-0.00510971072703084,0.00399664881036829,-0.0480461575242661,-0.00714094678712380,0.0169609280254513,-0.0162852958871900,0.00180709670452466,0.0388621483308425,-0.0393702020936343,0.0329701557419335,-0.00185085181819040,0.848927347262975,0.00400860085803719,0.0223102737510962,-0.00791368331580768,0.00446777541663617,0.0143130797178335,0.0641173785714405;-0.0274322501828962,0.0143453857243818,0.0334828518970993,0.0229404386789829,0.0369985687359790,0.0113016498056047,-0.0373934947873431,-0.0202310875052133,-0.0113117506722890,-0.0161079865219964,-0.0410443308888808,-0.0464413772964535,0.0288098970788123,0.00400860085802023,0.833966746719864,-0.0374589195101803,0.0319521250431365,-0.0475026903585783,-0.0273886499460608,0.0518223939357724;0.0195318365354893,-0.0226454750493495,0.0288293753833822,-0.00665152436828452,0.0262519874355980,0.0524041085615055,0.0222300873224953,0.00133600742018683,-0.0116846267825368,-0.0390900074356020,-0.0372469713964600,0.0156486062566702,-0.0234488425242679,0.0223102737510937,-0.0374589195101807,0.892665748248127,-0.00704138657468771,0.0132500515519578,0.0171530291749996,-0.0152273903471682;-0.0321114922656205,-0.0306908483144122,0.0590771999756262,0.00296457023853144,-0.00154914201904740,0.0101051141829485,0.0440603957750595,0.00158295620337989,-0.0339810836420542,-0.00361404282406976,-0.00638592330279604,-0.00946310220329198,-0.0281423655796505,-0.00791368331581236,0.0319521250431489,-0.00704138657468547,0.763698847983489,-0.0179286120810436,-0.0161571447448982,0.0199956469656750;-0.0277608095271073,0.0101133386305410,0.0555044137290155,0.0271678453723320,0.0308883195578789,0.0301266580699698,-0.00651294121238616,0.0152485581595826,0.0131768428263667,0.0415484759149544,0.0243056307455210,0.0442081474937243,0.000386811078895152,0.00446777541661865,-0.0475026903585773,0.0132500515519582,-0.0179286120810561,0.782076096927399,0.0267562574627548,0.0336779895039611;-0.0108329647767027,-0.00642336495811486,-0.0109469984697414,0.0345402241147680,-0.0106460352104586,-0.0128447271075607,-0.00420374073746375,-0.0220805527361388,-0.0302368596460567,-0.0296353305326910,0.0336035853070054,-0.0300404969909593,0.00163874801184142,0.0143130797178278,-0.0273886499460562,0.0171530291750004,-0.0161571447449009,0.0267562574627597,0.699008692900323,0.0162287068818096;-0.0313653239732383,0.0320716648153360,-0.00438121382528504,-0.0230233937130582,0.0127719109801514,0.000519920964561429,0.0198075735708305,0.00180876032808366,-0.0186422857530402,0.0377897473257301,0.0141452972708674,0.00724437683503343,-0.0189331007686663,0.0641173785714542,0.0518223939357718,-0.0152273903471689,0.0199956469656849,0.0336779895039615,0.0162287068818134,0.767321661841593];
   s = [-2,-88,59,-16,96,47,2,82,-66,37,-76,41,42,-76,75,80,37,-70,-95,-34];
   x = (x+s)*M;
else

end
f = @(x) 10.*abs(sin(0.1*x))+ 3*10^(-9)*zigzag(x,k,m,lmbd).*abs((x-40).*(x-185).*x.*(x+50).*(x+180) );
val = sum(f(f(x)),2);

end

function [valz] = zigzag(xs,k,m,lmbd)
    valz = zeros(size(xs));
    xs = abs(xs); 
    xs = xs/k - floor(xs/k);
    ids = xs<=lmbd;
    valz = 1-m+ids*m.*(xs/lmbd) + (1-ids).*m.*(1-(xs-lmbd)/((1-lmbd)));
end

